---
import getGithubContributions from "@utils/contributionsCalendar";
import CalendarGrid from "./CalendarGrid.astro";
import CalendarTile from "./CalendarTile.astro";

const result = await getGithubContributions();

Astro.response.headers.set(
  "Cache-Control",
  "public, s-maxage=86400, stale-while-revalidate=60",
);
---

{
  "totalContributions" in result ? (
    <>
      <span class="font-semibold md:text-2xl">
        {result.totalContributions !== undefined &&
          `${result.totalContributions} contribution` +
            (result.totalContributions === 1 ? " " : "s ") +
            "on Github in the last year"}
      </span>
      <CalendarGrid>
        {result.weeks?.map((week) =>
          week.contributionDays.map(({ contributionCount, date }) => (
            <CalendarTile
              contributions={contributionCount}
              {date}
            />
          )),
        )}
      </CalendarGrid>
    </>
  ) : (
    <span>{result.message}</span>
  )
}
